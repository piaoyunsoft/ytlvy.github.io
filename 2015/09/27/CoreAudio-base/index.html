<!doctype html>
<html class="theme-next use-motion ">
<head>
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">


<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>


<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.3"/>


    <meta name="description" content="notes for study" />



  <meta name="keywords" content="Audio," />



  <link rel="alternate" href="/atom.xml" title="Yt's Blog" type="application/atom+xml" />



  <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.4.3" />



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: '',
    analytics: {
      google: ''
    },
    sidebar: 'post'
  };
</script>


  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?b8a916e09c6b39221eb089c8ad75ede9";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



  <title> CoreAudio base // Yt's Blog </title>
</head>

<body>
<!--[if lte IE 8]> <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'> <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode"><img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820" alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari." style='margin-left:auto;margin-right:auto;display: block;'/></a></div> <![endif]-->
  <div class="container one-column page-post-detail">
    <div class="headband"></div>

    <div id="header" class="header">
      <div class="header-inner">
        <h1 class="site-meta">
  <span class="logo-line-before"><i></i></span>
  <a href="/" class="brand">
      <span class="logo">
        <i class="icon-logo"></i>
      </span>
      <span class="site-title">Yt's Blog</span>
  </a>
  <span class="logo-line-after"><i></i></span>
</h1>


  <ul id="menu" class="menu">
     
    
      
      <li class="menu-item menu-item-home">
        <a href="/">
          <i class="menu-item-icon icon-home"></i> <br />
          首頁
        </a>
      </li>
    
      
      <li class="menu-item menu-item-categories">
        <a href="/categories">
          <i class="menu-item-icon icon-categories"></i> <br />
          分類
        </a>
      </li>
    
      
      <li class="menu-item menu-item-about">
        <a href="/about">
          <i class="menu-item-icon icon-about"></i> <br />
          關於
        </a>
      </li>
    
      
      <li class="menu-item menu-item-archives">
        <a href="/archives">
          <i class="menu-item-icon icon-archives"></i> <br />
          歸檔
        </a>
      </li>
    
      
      <li class="menu-item menu-item-tags">
        <a href="/tags">
          <i class="menu-item-icon icon-tags"></i> <br />
          標籤
        </a>
      </li>
    
  </ul>


      </div>
    </div>

    <div id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          

  <div id="posts" class="posts-expand">
    

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              CoreAudio base
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          發表於 2015-09-27
        </span>

        
          <span class="post-category">
            &nbsp; | &nbsp; 分類於
            
              <a href="/categories/IOS/">IOS</a>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/09/27/CoreAudio-base/#comments" >
              <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/09/27/CoreAudio-base/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    <div class="post-body">

      
      

      
        <h1 id="CoreAudio_-&gt;_基本知识">CoreAudio -&gt; 基本知识</h1><p>自从开始Cocoa编程到现在，总会有人问，iOS，Mac有哪些框架，Cocoa与Cocoa Touch有什么区别？苹果官网早有详细的介绍,见 Mac iOS</p>
<p>最近在研究CoreAudio&gt;AudioUnit.framework音频处理部分，这部分内容文档少的可怜，可参照的内容有《CoreAudio Overview Mac/iOS》，Sample Code, WWDC, Apple Mailing List. 剩下的就只剩头文件注释和函数返回的错误码了。就像解密一样，如果你知道什么是成功，然后再有较为完备的试错方案，那你离成功应该不远了，剩下的只是时间的问题。</p>
<p>查文档的时候，有些内容Google一下，甚至只有几页内容。大部分时候都是连续打开20几个链接，却很少发现有价值的内容。有些算法相当神奇，听都没听过，更遗憾的是，我的笨拙的耳朵完全无法区分这对音频有哪些影响。但还是对音频有一定的理解,总结如下：</p>
<h2 id="基本术语">基本术语</h2><ul>
<li><strong>Sample(采样)</strong>：某个频道中单次捕获的音频数值（如图，单个紫色方块）</li>
<li><strong>Frame(一帧)</strong>：同一时间不同声道获取的采样值，例如，对于双声道，一帧包含两个数字，左声道和右声道（如图，第一列的多个声道中的3个紫色方块）</li>
<li><strong>Packet(包)</strong>：由一个或多个连续帧(Frame)组成, 在线性PCM中，一包总是只包含一帧，但对于其他压缩格式，一包要包含多个帧</li>
<li><strong>Sample Rate(采样率)</strong>：单个声道一秒内有多少个采样(如图，每个声道一秒内有多少个紫色方块)，例如，CD的采样率为44.1KHz(samples / sec) </li>
<li><strong>Bit Depth(位深)</strong>：采样值用多少位的数字来表示，例如CD的采样值用16-bit整形来表示 (bits / sample) </li>
<li><strong>Bit rate(比特率)</strong> = <strong>Bit_Depth x Sample_Rate (bits / sec</strong>) PCM bit rate is constant while oompressed format often usae a variable bit rate</li>
</ul>
<a id="more"></a>
<p><img src="http://deanmon-blogmedia.stor.sinaapp.com/ios_core_audio_pcm_concepts.png" alt=""></p>
<h2 id="What_is_linear(什么是线性的)？">What is linear(什么是线性的)？</h2><p>在线性PCM数据中，表示声源信息的采样值是线性变化的，例如，标准CD采用16-bit来表示声源信息，一共有65，536中可能的值，来表示无声和最大值，如同日常的楼梯一样，每个相邻的差值总是相同的。</p>
<h2 id="CoreAudio音频格式-AudioStreamBasicDescription(ASBD)">CoreAudio音频格式-AudioStreamBasicDescription(ASBD)</h2><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ASBD描述音频基本信息(采样率，数据格式，包大小, 声道等)</span></span><br><span class="line"><span class="keyword">struct</span> AudioStreamBasicDescription</span><br><span class="line">&#123;</span><br><span class="line">    Float64 mSampleRate;</span><br><span class="line">    <span class="built_in">UInt32</span>  mFormatID;</span><br><span class="line">    <span class="built_in">UInt32</span>  mFormatFlags;</span><br><span class="line">    <span class="built_in">UInt32</span>  mBytesPerPacket;</span><br><span class="line">    <span class="built_in">UInt32</span>  mFramesPerPacket;</span><br><span class="line">    <span class="built_in">UInt32</span>  mBytesPerFrame;</span><br><span class="line">    <span class="built_in">UInt32</span>  mChannelsPerFrame;</span><br><span class="line">    <span class="built_in">UInt32</span>  mBitsPerChannel;    <span class="comment">//对于压缩音频格式, 若BitsPerChannel非固定值时,0</span></span><br><span class="line">    <span class="built_in">UInt32</span>  mReserved;          <span class="comment">//总是0</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> AudioStreamBasicDescription  AudioStreamBasicDescription;</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//对于一些压缩格式没有固定的包大小，则需要以下数据结构</span></span><br><span class="line"><span class="keyword">struct</span>  AudioStreamPacketDescription &#123;</span><br><span class="line">    SInt64  mStartOffset;             <span class="comment">//起始偏移量</span></span><br><span class="line">    <span class="built_in">UInt32</span>  mVariableFramesInPacket;  <span class="comment">//包中帧数量,若(bit-rate)为固定值时，0</span></span><br><span class="line">    <span class="built_in">UInt32</span>  mDataByteSize;            <span class="comment">//数据字节大小</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> AudioStreamPacketDescription AudioStreamPacketDescription;</span><br></pre></td></tr></table></figure>
<h2 id="Core_Audio_Canonical_Audio_Data_Formats(Core_Audio标准音频格式)：">Core Audio Canonical Audio Data Formats(Core Audio标准音频格式)：</h2><p>标准格式的意义可能是：</p>
<ul>
<li>要求作为数据转换的中转数据格式</li>
<li>该音频格式已被Core Audio优化</li>
<li>若没有指定格式，该标准音频格式为默认格式(实践一些Audio Unit并不是这个默认格式,甚至不支持这个格式)</li>
</ul>
<h3 id="Input/Output(输入输出):">Input/Output(输入输出):</h3><p>OSX: Linear PCM with 32-bit floating point samples<br>iOS: Linear PCM with 16-bit integer samples</p>
<h3 id="Audio_unit_and_audio_processing(音频处理)：">Audio unit and audio processing(音频处理)：</h3><p><strong>AudioFormatFlagsAudioUnitCanonical</strong></p>
<p>OSX: Noninterleaved linear PCM with 32-bit floating point samples<br>iOS: Noninterleaved linear PCM with 8.24-bit fixed-point samples</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">AudioStreamBasicDescription</span> </span>&#123;                         </span><br><span class="line">    mSampleRate       = <span class="number">44100.0</span>;                             <span class="comment">//采样率</span></span><br><span class="line">    mFormatID         = kAudioFormatLinearPCM;               <span class="comment">//音频格式Linear PCM         </span></span><br><span class="line">    mFormatFlags      = kAudioFormatFlagsAudioUnitCanonical; <span class="comment">//上述的标准格式</span></span><br><span class="line">    mBytesPerPacket   = <span class="number">1</span> * <span class="built_in">sizeof</span> (<span class="type">AudioUnitSampleType</span>);    <span class="comment">// 8 WTF</span></span><br><span class="line">    mFramesPerPacket  = <span class="number">1</span>;                                   <span class="comment">//Linear PCM每包只有1帧</span></span><br><span class="line">    mBytesPerFrame    = <span class="number">1</span> * <span class="built_in">sizeof</span> (<span class="type">AudioUnitSampleType</span>);    <span class="comment">// 8  WTF</span></span><br><span class="line">    mChannelsPerFrame = <span class="number">2</span>;                                   <span class="comment">// 2个声道</span></span><br><span class="line">    mBitsPerChannel   = <span class="number">8</span> * <span class="built_in">sizeof</span> (<span class="type">AudioUnitSampleType</span>);    <span class="comment">// 32</span></span><br><span class="line">    mReserved         = <span class="number">0</span>;                                   <span class="comment">// 0</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="AudioBufferList(Inter-leaved_vs_non-interleaved)">AudioBufferList(Inter-leaved vs non-interleaved)</h2><ul>
<li><strong>Inter-leaved</strong>: 如果一个流数据中包含多个声道，多用于播放(play back)，便于同时读取多个声道信息</li>
<li><strong>Non-interleaved</strong>: 多用于音频处理(DSP), 这样可以专注处理其中某一个声道</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*!</span><br><span class="line">    <span class="doctag">@struct</span>         AudioBufferList</span><br><span class="line">    <span class="doctag">@abstract</span>       A variable length array of AudioBuffer structures.</span><br><span class="line">    <span class="doctag">@field</span>          mNumberBuffers</span><br><span class="line">                        The number of AudioBuffers in the mBuffers array.</span><br><span class="line">    <span class="doctag">@field</span>          mBuffers</span><br><span class="line">                        A variable length array of AudioBuffers.</span><br><span class="line">*/</span></span><br><span class="line">struct AudioBufferList</span><br><span class="line">&#123;</span><br><span class="line">    UInt32      mNumberBuffers;</span><br><span class="line">    AudioBuffer mBuffers[<span class="number">1</span>]; <span class="comment">// this is a variable length array of mNumberBuffers elements</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">#if defined(__cplusplus) &amp;&amp; CA_STRICT</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    AudioBufferList() &#123;&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">//  Copying and assigning a variable length struct is problematic so turn their use into a</span></span><br><span class="line">    <span class="comment">//  compile time error for eacy spotting.</span></span><br><span class="line">    AudioBufferList(<span class="keyword">const</span> AudioBufferList&amp;);</span><br><span class="line">    AudioBufferList&amp;    operator=(<span class="keyword">const</span> AudioBufferList&amp;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*!</span><br><span class="line">    <span class="doctag">@struct</span>         AudioBuffer</span><br><span class="line">    <span class="doctag">@abstract</span>       A structure to hold a buffer of audio data.</span><br><span class="line">    <span class="doctag">@field</span>          mNumberChannels</span><br><span class="line">                        The number of interleaved channels in the buffer.</span><br><span class="line">    <span class="doctag">@field</span>          mDataByteSize</span><br><span class="line">                        The number of bytes in the buffer pointed at by mData.</span><br><span class="line">    <span class="doctag">@field</span>          mData</span><br><span class="line">                        A pointer to the buffer of audio data.</span><br><span class="line">*/</span></span><br><span class="line">struct AudioBuffer</span><br><span class="line">&#123;</span><br><span class="line">    UInt32  mNumberChannels;</span><br><span class="line">    UInt32  mDataByteSize;</span><br><span class="line">    void*   mData;</span><br><span class="line">&#125;;</span><br><span class="line">typedef struct AudioBuffer  AudioBuffer;</span><br></pre></td></tr></table></figure>
<p>Inter-leaved vs non-interleaved:</p>
<p>以双声道为例</p>
<p><img src="http://deanmon-blogmedia.stor.sinaapp.com/ios_core_audio_pcm_concepts_interleaved_versus_noninterleaved.png" alt=""></p>
<h2 id="8-24-Fixed_Point">8.24-Fixed Point</h2><p>一下为音频8-24 fixed-point 转换为float的部分截图</p>
<p><img src="http://deanmon-blogmedia.stor.sinaapp.com/ios_core_audio_pcm_concepts_xcode_memory_snapshot.png" alt=""></p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">(lldb) x -s4 -fb -c<span class="number">4 0x04d1</span>c000</span><br><span class="line"><span class="number">0x04d1c00</span>0: <span class="number">0b00000000</span><span class="number">000011000111</span><span class="number">00101000100</span>0</span><br><span class="line"><span class="number">0x04d1c00</span>4: <span class="number">0b00000000</span><span class="number">000000101001</span><span class="number">100111001000</span></span><br><span class="line"><span class="number">0x04d1c00</span>8: <span class="number">0b00000000</span><span class="number">00001101001</span><span class="number">0111001011100</span></span><br><span class="line"><span class="number">0x04d1c00</span>c: <span class="number">0b00000000</span><span class="number">00000100101</span><span class="number">1011110110100</span></span><br><span class="line">(lldb) x -s4 -fh -c<span class="number">4 0x04d1</span>c000</span><br><span class="line"><span class="number">0x04d1c00</span>0: <span class="number">0x000c72</span><span class="number">88 0x00029</span><span class="number">9c8 0x00</span>0d2e5c <span class="number">0x0004b7</span>b4  </span><br><span class="line">  </span><br><span class="line">interleaved</span><br><span class="line">L+R(8.24) </span><br><span class="line"><span class="number">0x04d1c00</span>0: <span class="number">0b00000000</span> <span class="number">000011000111</span><span class="number">00101000100</span>0  float(<span class="number">0b00001100</span><span class="number">011100101000</span>1000)/2**24 = <span class="number">0.04862260</span><span class="number">818481445</span> L</span><br><span class="line"><span class="number">0x04d1c00</span>4: <span class="number">0b00000000</span> <span class="number">000000101001</span><span class="number">100111001000</span>  float(<span class="number">0b000000101</span><span class="number">00110011100100</span>0)/2**24 = <span class="number">0.0101590156</span><span class="number">55517578</span> R</span><br><span class="line"><span class="number">0x04d1c00</span>8: <span class="number">0b00000000</span> <span class="number">00001101001</span><span class="number">0111001011100</span>  float(<span class="number">0b00001101</span><span class="number">001011100101</span>1100)/2**24 = <span class="number">0.05148863</span><span class="number">7924194336</span> L</span><br><span class="line"><span class="number">0x04d1c00</span>c: <span class="number">0b00000000</span> <span class="number">00000100101</span><span class="number">1011110110100</span>  float(<span class="number">0b00000100</span><span class="number">10110111101101</span>00)/2**24 = <span class="number">0.01842808</span><span class="number">723449707</span> R</span><br><span class="line"></span><br><span class="line">non-interleaved</span><br><span class="line">L(float) </span><br><span class="line"><span class="number">0x04d12000</span>: <span class="number">0b0011110101</span><span class="number">0001110010100</span><span class="number">010000000</span></span><br><span class="line"><span class="number">0x04d12004</span>: <span class="number">0b0011110101</span><span class="number">010010111001</span><span class="number">0111000000</span></span><br><span class="line"></span><br><span class="line"><span class="number">0x04d12000</span>: <span class="number">0.0486226</span></span><br><span class="line"><span class="number">0x04d12004</span>: <span class="number">0.0514886</span></span><br><span class="line"></span><br><span class="line">//R(float) binary and float</span><br><span class="line"><span class="number">0x04d24000</span>: <span class="number">0b001111000</span><span class="number">010011001110</span><span class="number">01000000000</span></span><br><span class="line"><span class="number">0x04d24004</span>: <span class="number">0b001111001</span><span class="number">001011011110</span><span class="number">11010000000</span></span><br><span class="line"></span><br><span class="line"><span class="number">0x04d24000</span>: <span class="number">0.010159</span></span><br><span class="line"><span class="number">0x04d24004</span>: <span class="number">0.0184281</span></span><br></pre></td></tr></table></figure>
<h2 id="音频的文件类型与数据类型_$_afconvert">音频的文件类型与数据类型 $ afconvert</h2><p>在MAC的Shell中，Core Audio提供命令行工具afconvert，如下，命令与结果给你一个初步的概念，CoreAudio支持那些格式预编码<br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">$ afconvert <span class="comment">--help-formats</span></span><br><span class="line"><span class="comment">#解释：若data_formats不是字符串，则表示LPCM数据 [BE|LE]&#123;F|[U]I&#125;&#123;8|16|24|32|64&#125;</span></span><br><span class="line"><span class="comment">#BE = Big Endian</span></span><br><span class="line"><span class="comment">#LE = Little Endian</span></span><br><span class="line"><span class="comment">#F = 浮点型 UI = 无符号整形 I = 整形</span></span><br><span class="line"><span class="comment">#8|16|24|32|64 = 位深(bit depth)</span></span><br><span class="line">Audio <span class="built_in">file</span> <span class="operator">and</span> data formats:</span><br><span class="line">    <span class="string">'3gpp'</span> = <span class="number">3</span>GP Audio (.<span class="number">3</span>gp)<span class="comment"> //可识别文件后缀名</span></span><br><span class="line">               data_formats: <span class="string">'Qclp'</span> <span class="string">'aac '</span> <span class="string">'aace'</span> <span class="string">'aacf'</span> <span class="string">'aach'</span> <span class="string">'aacl'</span> </span><br><span class="line">                             <span class="string">'aacp'</span> <span class="string">'samr'</span><span class="comment"> //可能的数据编码格式</span></span><br><span class="line">    <span class="string">'3gp2'</span> = <span class="number">3</span>GPP-<span class="number">2</span> Audio (.<span class="number">3</span>g2)</span><br><span class="line">               data_formats: <span class="string">'Qclp'</span> <span class="string">'aac '</span> <span class="string">'aace'</span> <span class="string">'aacf'</span> <span class="string">'aach'</span> <span class="string">'aacl'</span> </span><br><span class="line">                             <span class="string">'aacp'</span> <span class="string">'samr'</span> </span><br><span class="line">    <span class="string">'adts'</span> = AAC ADTS (.aac, .adts)</span><br><span class="line">               data_formats: <span class="string">'aac '</span> <span class="string">'aach'</span> <span class="string">'aacp'</span> </span><br><span class="line">    <span class="string">'ac-3'</span> = AC3 (.ac3)</span><br><span class="line">               data_formats: <span class="string">'ac-3'</span> </span><br><span class="line">    <span class="string">'AIFC'</span> = AIFC (.aifc, .aiff, .aif)</span><br><span class="line">               data_formats: I8 BEI16 BEI24 BEI32 BEF32 BEF64 UI8 <span class="string">'ulaw'</span> </span><br><span class="line">                             <span class="string">'alaw'</span> <span class="string">'MAC3'</span> <span class="string">'MAC6'</span> <span class="string">'ima4'</span> <span class="string">'QDMC'</span> <span class="string">'QDM2'</span> </span><br><span class="line">                             <span class="string">'Qclp'</span> <span class="string">'agsm'</span> </span><br><span class="line">    <span class="string">'AIFF'</span> = AIFF (.aiff, .aif)</span><br><span class="line">               data_formats: I8 BEI16 BEI24 BEI32 </span><br><span class="line">    <span class="string">'amrf'</span> = AMR (.amr)</span><br><span class="line">               data_formats: <span class="string">'samr'</span> </span><br><span class="line">    <span class="string">'m4af'</span> = Apple MPEG-<span class="number">4</span> Audio (.m4a, .m4r)</span><br><span class="line">               data_formats: <span class="string">'aac '</span> <span class="string">'aace'</span> <span class="string">'aacf'</span> <span class="string">'aach'</span> <span class="string">'aacl'</span> <span class="string">'aacp'</span> </span><br><span class="line">                             <span class="string">'alac'</span> <span class="string">'paac'</span> </span><br><span class="line">    <span class="string">'m4bf'</span> = Apple MPEG-<span class="number">4</span> AudioBooks (.m4b)</span><br><span class="line">               data_formats: <span class="string">'aac '</span> <span class="string">'aace'</span> <span class="string">'aacf'</span> <span class="string">'aach'</span> <span class="string">'aacl'</span> <span class="string">'aacp'</span> </span><br><span class="line">                             <span class="string">'paac'</span> </span><br><span class="line">    <span class="string">'caff'</span> = CAF (.caf)</span><br><span class="line">               data_formats: <span class="string">'.mp1'</span> <span class="string">'.mp2'</span> <span class="string">'.mp3'</span> <span class="string">'QDM2'</span> <span class="string">'QDMC'</span> <span class="string">'Qclp'</span> </span><br><span class="line">                             <span class="string">'Qclq'</span> <span class="string">'aac '</span> <span class="string">'aace'</span> <span class="string">'aacf'</span> <span class="string">'aach'</span> <span class="string">'aacl'</span> </span><br><span class="line">                             <span class="string">'aacp'</span> <span class="string">'alac'</span> <span class="string">'alaw'</span> <span class="string">'dvi8'</span> <span class="string">'ilbc'</span> <span class="string">'ima4'</span> </span><br><span class="line">                             I8 BEI16 BEI24 BEI32 BEF32 BEF64 LEI16 LEI24 </span><br><span class="line">                             LEI32 LEF32 LEF64 <span class="string">'ms\x00\x02'</span> <span class="string">'ms\x00\x11'</span> </span><br><span class="line">                             <span class="string">'ms\x001'</span> <span class="string">'paac'</span> <span class="string">'samr'</span> <span class="string">'ulaw'</span> </span><br><span class="line">    <span class="string">'MPG1'</span> = MPEG Layer <span class="number">1</span> (.mp1, .mpeg, .mpa)</span><br><span class="line">               data_formats: <span class="string">'.mp1'</span> </span><br><span class="line">    <span class="string">'MPG2'</span> = MPEG Layer <span class="number">2</span> (.mp2, .mpeg, .mpa)</span><br><span class="line">               data_formats: <span class="string">'.mp2'</span> </span><br><span class="line">    <span class="string">'MPG3'</span> = MPEG Layer <span class="number">3</span> (.mp3, .mpeg, .mpa)</span><br><span class="line">               data_formats: <span class="string">'.mp3'</span> </span><br><span class="line">    <span class="string">'mp4f'</span> = MPEG-<span class="number">4</span> Audio (.mp4)</span><br><span class="line">               data_formats: <span class="string">'aac '</span> <span class="string">'aace'</span> <span class="string">'aacf'</span> <span class="string">'aach'</span> <span class="string">'aacl'</span> <span class="string">'aacp'</span> </span><br><span class="line">    <span class="string">'NeXT'</span> = NeXT/Sun (.snd, .au)</span><br><span class="line">               data_formats: I8 BEI16 BEI24 BEI32 BEF32 BEF64 <span class="string">'ulaw'</span> </span><br><span class="line">    <span class="string">'Sd2f'</span> = Sound Designer II (.sd2)</span><br><span class="line">               data_formats: I8 BEI16 BEI24 BEI32 </span><br><span class="line">    <span class="string">'WAVE'</span> = WAVE (.wav)</span><br><span class="line">               data_formats: UI8 LEI16 LEI24 LEI32 LEF32 LEF64 <span class="string">'ulaw'</span> </span><br><span class="line">                             <span class="string">'alaw'</span></span><br></pre></td></tr></table></figure></p>
<p>可以看到.caf的文件支持所有类型的数据格式，我们可以将以下MP3文件转成Caf(LEI16)文件：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ afconvert aviation+youweremyeverything<span class="class">.mp3</span> -d LEI16 output.caf</span><br></pre></td></tr></table></figure>
<h3 id="音频文件信息$_afinfo">音频文件信息$ afinfo</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ afinfo aviation+youweremyeverything.mp3</span><br><span class="line"></span><br><span class="line"><span class="code"> </span></span><br><span class="line">File:           aviation+youweremyeverything.mp3</span><br><span class="line">File type ID:   MPG3</span><br><span class="line"><span class="header">Num Tracks:     1</span><br><span class="line">----</span></span><br><span class="line">Data format:     2 ch,  44100 Hz, <span class="emphasis">'.mp3'</span> (0x00000000) 0 bits/channel, 0 bytes/packet, 1152 frames/packet, 0 bytes/frame</span><br><span class="line"><span class="code">                no channel layout.</span></span><br><span class="line">estimated duration: 311.570438 sec</span><br><span class="line">audio bytes: 4985127</span><br><span class="line">audio packets: 11927</span><br><span class="line">bit rate: 128000 bits per second</span><br><span class="line">packet size upper bound: 1052</span><br><span class="line">maximum packet size: 418</span><br><span class="line">audio data file offset: 2475</span><br><span class="line"><span class="header">optimized</span><br><span class="line">----</span></span><br></pre></td></tr></table></figure>
<p>面对那么多的参数，起码这个命令给你个感觉，该音频文件都有哪些参数</p>
<h3 id="音频播放$_afplay">音频播放$ afplay</h3><p>afplay aviation+youweremyeverything.mp3 </p>
<p>电子语音$ say</p>
<figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">say</span> hello world</span><br></pre></td></tr></table></figure>
<p>很酷的命令，是吧！可以从命令行播放core audio能识别的音频，我喜欢的歌：《you were my everything》</p>
<p>PS：此外还有命令afclip afhash afmtodit, 此时还不知道这些是干什么用的，以后知道了再补上 </p>
<h3 id="CoreAudio_Helper_API_—_AudioToolBox(CoreAudio辅助API)">CoreAudio Helper API — AudioToolBox(CoreAudio辅助API)</h3><p>播放音频文件，通常需要将文件音频转码为canonical data(见Part I),才能用于播发，处理等操作。<br>相反录音，通常将canonical data转换成文件格式写入磁盘。</p>
<p>2x包含解码的API：</p>
<p>AudioQueue API能够将音频文件转码能LPCM用于播放<br>Extended Audio File Services API 能够将音频文件转成PCM, 或者将PCM直接转成压缩文件写入磁盘</p>
<p>3x播放引擎：1.AudioQueue 2.Audio Unit 3.OpenAL</p>
<h3 id="AUAudioFilePlayer_property">AUAudioFilePlayer property</h3><ul>
<li>kAudioUnitProperty_ScheduleStartTimeStamp</li>
<li>kAudioUnitProperty_ScheduledFilePrime</li>
<li>kAudioUnitProperty_ScheduledFileRegion</li>
</ul>
<ol>
<li><p>The StartTime is exactly what you’d think it is: it defines the beginning of the playback timeline for all slices/regions that you’re scheduling for that audio unit.</p>
</li>
<li><p>Since the audio data needs to be pulled into RAM prior to playing, “priming” basically tells the system to begin reading the audio file (the specified number of frames) into memory.</p>
</li>
<li><p>You have the option of playing just a part of a file (beginning some number of frames into the file and/or ending some number of frames before the end of the file). These are called “regions” and this is the property you use if you want to play just a portion (or region) of an audio file.</p>
</li>
</ol>
<p>Have a look at AudioUnitProperties.h:<br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Start Time</span><br><span class="line"></span><br><span class="line">The audio unit will <span class="operator">not</span> play <span class="keyword">any</span> slices following initialization <span class="operator">or</span> reset, <span class="keyword">until</span> its <span class="built_in">start</span> <span class="built_in">time</span> has been <span class="built_in">set</span>. The <span class="built_in">start</span> <span class="built_in">time</span> establishes <span class="operator">the</span> beginning <span class="operator">of</span> <span class="operator">a</span> timeline: <span class="operator">the</span> timestamps <span class="operator">of</span> all slices <span class="operator">in</span> <span class="operator">the</span> schedule are <span class="built_in">relative</span> <span class="built_in">to</span> <span class="operator">the</span> <span class="built_in">start</span> <span class="built_in">time</span>.</span><br><span class="line"></span><br><span class="line">Set <span class="operator">a</span> <span class="built_in">start</span> <span class="built_in">time</span> <span class="keyword">by</span> setting <span class="operator">the</span> kAudioUnitProperty_ScheduleStartTimeStamp property <span class="operator">with</span> <span class="operator">an</span> AudioTimeStamp structure. If <span class="operator">the</span> timestamp <span class="operator">contains</span> <span class="operator">a</span> valid sample <span class="built_in">time</span> (timestamp.mFlags &amp; kAudioTimeStampSampleTimeValid), <span class="keyword">then</span> playback <span class="operator">begins</span> when <span class="operator">the</span> timestamp passed <span class="built_in">to</span> <span class="operator">the</span> AudioUnitRender <span class="function"><span class="keyword">function</span> <span class="title">reaches</span> <span class="title">the</span> <span class="title">specified</span> <span class="title">sample</span> <span class="title">time</span>. <span class="title">If</span> <span class="title">the</span> <span class="title">specified</span> <span class="title">sample</span> <span class="title">time</span> <span class="title">is</span> -<span class="title">1</span>, <span class="title">playback</span> <span class="title">begins</span> <span class="title">on</span> <span class="title">the</span> <span class="title">next</span> <span class="title">render</span> <span class="title">cycle</span>.</span></span><br><span class="line"></span><br><span class="line">If <span class="operator">the</span> <span class="built_in">start</span> timestamp does <span class="operator">not</span> contain <span class="operator">a</span> valid sample <span class="built_in">time</span>, but does contain <span class="operator">a</span> valid host <span class="built_in">time</span> (timestamp.mFlags &amp; kAudioTimeStampHostTimeValid), <span class="keyword">then</span> <span class="operator">the</span> specified host <span class="built_in">time</span> is translated <span class="built_in">to</span> <span class="operator">the</span> sample <span class="built_in">time</span> <span class="keyword">at</span> which playback will begin. A host <span class="built_in">time</span> <span class="operator">of</span> <span class="number">0</span> means <span class="string">"start on the next render cycle."</span></span><br><span class="line"></span><br><span class="line">The kAudioUnitProperty_ScheduleStartTimeStamp property may be queried <span class="built_in">to</span> obtain <span class="operator">the</span> <span class="built_in">time</span> <span class="keyword">at</span> which playback began. If <span class="operator">the</span> <span class="built_in">start</span> <span class="built_in">time</span> has <span class="operator">not</span> yet been reached, <span class="operator">the</span> timestamp returned will be whatever <span class="operator">the</span> host application <span class="keyword">last</span> <span class="built_in">set</span>.</span><br><span class="line"></span><br><span class="line">Priming</span><br><span class="line"></span><br><span class="line">You should <span class="built_in">set</span> kAudioUnitProperty_ScheduledFilePrime <span class="keyword">after</span> scheduling initial <span class="built_in">file</span> regions <span class="built_in">to</span> be played <span class="operator">and</span> <span class="keyword">before</span> starting playback. This SetProperty call will begin reading <span class="operator">the</span> audio <span class="built_in">files</span> <span class="operator">and</span> <span class="operator">not</span> <span class="constant">return</span> <span class="keyword">until</span> <span class="operator">the</span> <span class="built_in">number</span> <span class="operator">of</span> frames specified <span class="keyword">by</span> <span class="operator">the</span> property <span class="built_in">value</span> have been <span class="built_in">read</span>.</span><br><span class="line"></span><br><span class="line">Scheduling Regions</span><br><span class="line"></span><br><span class="line">To schedule <span class="operator">the</span> playback <span class="operator">of</span> <span class="operator">a</span> region <span class="operator">of</span> <span class="operator">an</span> audio <span class="built_in">file</span>, <span class="built_in">set</span> <span class="operator">the</span> kAudioUnitProperty_ScheduledFileRegion property. This is <span class="operator">a</span> ScheduledAudioFileRegion structure. mTimeStamp.mSampleTime must be valid <span class="operator">and</span> is interpreted <span class="built_in">relative</span> <span class="built_in">to</span> <span class="operator">the</span> unit<span class="string">'s start time -- the start time semantics (using kAudioUnitProperty_ScheduleStartTimeStamp) are identical to those of AUScheduledSoundPlayer. Unlike the ScheduledAudioSlice structures, the unit makes copies of ScheduledAudioFileRegions, so you may create them on the stack or otherwise reuse/dispose of them immediately after scheduling them.</span></span><br></pre></td></tr></table></figure></p>
<h2 id="参考：">参考：</h2><ol>
<li>CoreAudio Official Link</li>
<li><a href="http://trac.bookofhook.com/bookofhook/trac.cgi/wiki/IntroductionToFixedPointMath" target="_blank" rel="external">Introduction to Fixed Point Math</a></li>
<li><a href="http://lists.apple.com/archives/coreaudio-api/2011/Feb/msg00083.html" target="_blank" rel="external">MailList: coreaudio-api@lists.apple.com:</a></li>
<li>GIT and APPLE SAMPLE CODE</li>
<li><a href="http://audacity.sourceforge.net/manual-1.2/effects_reverb.html" target="_blank" rel="external">reverb音效</a> <a href="http://www.freesoftwaremagazine.com/articles/understanding_surround_and_binaural_sound" target="_blank" rel="external">surround音效</a></li>
<li><a href="http://www.deluge.co/?q=content/coreaudio-iphone-creating-graphic-equalizer" target="_blank" rel="external">N-band EQ</a></li>
<li><a href="http://book.douban.com/subject/4238740/" target="_blank" rel="external">“Learning Core Audio”</a></li>
</ol>

      
    </div>

    <div class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Audio/"> #Audio </a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-prev post-nav-item">
            
              <a href="/2015/09/27/Crash-example/">Crash example</a>
            
          </div>

          <div class="post-nav-next post-nav-item">
            
              <a href="/2015/09/27/Assembly/">Assembly</a>
            
          </div>
        </div>
      

      
      
    </div>
  </div>



    
      <div class="comments" id="comments">
        
          <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          </div>
        
      </div>
    
  </div>


        </div>

        
      </div>


      
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <div id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目錄
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            本站概覽
          </li>
        </ul>
      

      <div class="site-overview">
        <div class="site-author motion-element">
          <img class="site-author-image" src="/avatar.png" alt="Yt" />
          <p class="site-author-name">Yt</p>
        </div>
        <p class="site-description motion-element">notes for study</p>
        <div class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">228</span>
              <span class="site-state-item-name">文章</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            <a href="/categories">
              <span class="site-state-item-count">28</span>
              <span class="site-state-item-name">分類</span>
              </a>
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">102</span>
              <span class="site-state-item-name">標籤</span>
              </a>
          </div>

        </div>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml">
              <i class="menu-item-icon icon-feed"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
              <a href="https://github.com/ytlvy" target="_blank">GitHub</a>
            </span>
            
              <span class="links-of-author-item">
              <a href="https://twitter.com/ytlvy" target="_blank">Twitter</a>
            </span>
            
              <span class="links-of-author-item">
              <a href="http://nshipster.com" target="_blank">NSHipster</a>
            </span>
            
              <span class="links-of-author-item">
              <a href="http://www.mikeash.com/pyblog" target="_blank">NSBlog</a>
            </span>
            
              <span class="links-of-author-item">
              <a href="http://www.objc.io" target="_blank">objcio</a>
            </span>
            
              <span class="links-of-author-item">
              <a href="http://www.raywenderlich.com" target="_blank">raywenderlich</a>
            </span>
            
          
        </div>

        
        
          <div class="cc-license motion-element">
            <a href="http://creativecommons.org/licenses/by-nc-sa/4.0" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons" />
            </a>
          </div>
        

      </div>

      
        <div class="post-toc-wrap sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator"></div>
          <div class="post-toc">
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#CoreAudio_->_基本知识"><span class="nav-number">1.</span> <span class="nav-text">CoreAudio -> 基本知识</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#基本术语"><span class="nav-number">1.1.</span> <span class="nav-text">基本术语</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#What_is_linear(什么是线性的)？"><span class="nav-number">1.2.</span> <span class="nav-text">What is linear(什么是线性的)？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CoreAudio音频格式-AudioStreamBasicDescription(ASBD)"><span class="nav-number">1.3.</span> <span class="nav-text">CoreAudio音频格式-AudioStreamBasicDescription(ASBD)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Core_Audio_Canonical_Audio_Data_Formats(Core_Audio标准音频格式)："><span class="nav-number">1.4.</span> <span class="nav-text">Core Audio Canonical Audio Data Formats(Core Audio标准音频格式)：</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Input/Output(输入输出):"><span class="nav-number">1.4.1.</span> <span class="nav-text">Input/Output(输入输出):</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Audio_unit_and_audio_processing(音频处理)："><span class="nav-number">1.4.2.</span> <span class="nav-text">Audio unit and audio processing(音频处理)：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AudioBufferList(Inter-leaved_vs_non-interleaved)"><span class="nav-number">1.5.</span> <span class="nav-text">AudioBufferList(Inter-leaved vs non-interleaved)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-24-Fixed_Point"><span class="nav-number">1.6.</span> <span class="nav-text">8.24-Fixed Point</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#音频的文件类型与数据类型_$_afconvert"><span class="nav-number">1.7.</span> <span class="nav-text">音频的文件类型与数据类型 $ afconvert</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#音频文件信息$_afinfo"><span class="nav-number">1.7.1.</span> <span class="nav-text">音频文件信息$ afinfo</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#音频播放$_afplay"><span class="nav-number">1.7.2.</span> <span class="nav-text">音频播放$ afplay</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CoreAudio_Helper_API_—_AudioToolBox(CoreAudio辅助API)"><span class="nav-number">1.7.3.</span> <span class="nav-text">CoreAudio Helper API — AudioToolBox(CoreAudio辅助API)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AUAudioFilePlayer_property"><span class="nav-number">1.7.4.</span> <span class="nav-text">AUAudioFilePlayer property</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考："><span class="nav-number">1.8.</span> <span class="nav-text">参考：</span></a></li></ol></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator"></div>
        </div>
      

    </div>
  </div>


    </div>

    <div id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; &nbsp; 
  2015
  <span class="with-love">
    <i class="icon-heart"></i>
  </span>
  <span class="author">Yt</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 強力驅動
</div>

<div class="theme-info">
  主題 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>
</div>



<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
<div class="theme-info">
  <span id="busuanzi_container_site_uv">
    &nbsp&nbsp&nbsp&nbsp|&nbsp&nbsp Total <span id="busuanzi_value_site_pv"><i class="fa fa-spinner fa-spin"></i></span> views.
您是本站的第<span id="busuanzi_value_site_uv"><i class="fa fa-spinner fa-spin"></i></span>个小伙伴
<span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span> Hits
  </span>
<div>
      </div>
    </div>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js"></script>


  <script type="text/javascript" src="/js/helpers.js"></script>
  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/js/motion_global.js" id="motion.global"></script>




  
  
<script type="text/javascript" src="/js/bootstrap.scrollspy.js" id="bootstrap.scrollspy.custom"></script>


<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var $sidebarInner = $('.sidebar-inner');
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.didShow', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;
          var self = this;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      $(indicator).velocity('stop').velocity({
        opacity: action === 'show' ? 0.4 : 0
      }, { duration: 100 });
    }

  });
</script>


  <script type="text/javascript" id="sidebar.nav">
    $(document).ready(function () {
      var html = $('html');

      $('.sidebar-nav li').on('click', function () {
        var item = $(this);
        var activeTabClassName = 'sidebar-nav-active';
        var activePanelClassName = 'sidebar-panel-active';
        if (item.hasClass(activeTabClassName)) {
          return;
        }

        var currentTarget = $('.' + activePanelClassName);
        var target = $('.' + item.data('target'));

        currentTarget.velocity('transition.slideUpOut', 200, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', 200)
            .addClass(activePanelClassName);
        });

        item.siblings().removeClass(activeTabClassName);
        item.addClass(activeTabClassName);
      });

      $('.post-toc a').on('click', function (e) {
        e.preventDefault();
        var offset = $(escapeSelector(this.getAttribute('href'))).offset().top;
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        });
      });

      // Expand sidebar on post detail page by default, when post has a toc.
      var $tocContent = $('.post-toc-content');
      if (isDesktop() && CONFIG.sidebar === 'post') {
        if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
          displaySidebar();
        }
      }
    });
  </script>




  <script type="text/javascript">
    $(document).ready(function () {
      if (CONFIG.sidebar === 'always') {
        displaySidebar();
      }
    });
  </script>

  

  
  
  

  

    
      
    

    <script type="text/javascript">
      var disqus_shortname = 'ytlvy';
      var disqus_identifier = '2015/09/27/CoreAudio-base/';
      var disqus_title = 'CoreAudio base';
      var disqus_url = 'http://ytlvy.com/2015/09/27/CoreAudio-base/';

      (function(){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }());
    </script>
  




  
  

</body>
</html>
