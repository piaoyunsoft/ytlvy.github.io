<!doctype html>
<html class="theme-next use-motion ">
<head>
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">


<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>


<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.3"/>


    <meta name="description" content="notes for study" />



  <meta name="keywords" content="Hexo,next" />



  <link rel="alternate" href="/atom.xml" title="Yt's Blog" type="application/atom+xml" />



  <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.4.3" />



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: '',
    analytics: {
      google: ''
    },
    sidebar: 'post'
  };
</script>


  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?b8a916e09c6b39221eb089c8ad75ede9";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



  <title> ios reverse // Yt's Blog </title>
</head>

<body>
<!--[if lte IE 8]> <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'> <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode"><img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820" alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari." style='margin-left:auto;margin-right:auto;display: block;'/></a></div> <![endif]-->
  <div class="container one-column page-post-detail">
    <div class="headband"></div>

    <div id="header" class="header">
      <div class="header-inner">
        <h1 class="site-meta">
  <span class="logo-line-before"><i></i></span>
  <a href="/" class="brand">
      <span class="logo">
        <i class="icon-logo"></i>
      </span>
      <span class="site-title">Yt's Blog</span>
  </a>
  <span class="logo-line-after"><i></i></span>
</h1>


  <ul id="menu" class="menu">
     
    
      
      <li class="menu-item menu-item-home">
        <a href="/">
          <i class="menu-item-icon icon-home"></i> <br />
          首頁
        </a>
      </li>
    
      
      <li class="menu-item menu-item-categories">
        <a href="/categories">
          <i class="menu-item-icon icon-categories"></i> <br />
          分類
        </a>
      </li>
    
      
      <li class="menu-item menu-item-about">
        <a href="/about">
          <i class="menu-item-icon icon-about"></i> <br />
          關於
        </a>
      </li>
    
      
      <li class="menu-item menu-item-archives">
        <a href="/archives">
          <i class="menu-item-icon icon-archives"></i> <br />
          歸檔
        </a>
      </li>
    
      
      <li class="menu-item menu-item-tags">
        <a href="/tags">
          <i class="menu-item-icon icon-tags"></i> <br />
          標籤
        </a>
      </li>
    
  </ul>


      </div>
    </div>

    <div id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          

  <div id="posts" class="posts-expand">
    

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              ios reverse
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          發表於 2015-05-30
        </span>

        
          <span class="post-category">
            &nbsp; | &nbsp; 分類於
            
              <a href="/categories/IOS/">IOS</a>

              
              
                ， 
              

            
              <a href="/categories/IOS/reverse/">reverse</a>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/05/30/ios-reverse/#comments" >
              <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/05/30/ios-reverse/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    <div class="post-body">

      
      

      
        <h3 id="class-dump-z">class-dump-z</h3><h4 id="下载配置class_dump_z">下载配置class_dump_z</h4><p>前往 <a href="https://code.google.com/p/networkpx/wiki/class_dump_z" target="_blank" rel="external">https://code.google.com/p/networkpx/wiki/class_dump_z</a> ，下载tar包，然后解压配置到本地环境<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>tar -zxvf <span class="class"><span class="keyword">class</span>-<span class="title">dump</span>-<span class="title">z_0</span>.2<span class="title">a</span>.<span class="title">tar</span>.<span class="title">gz</span>  </span></span><br><span class="line"><span class="variable">$ </span>sudo cp mac_x86/<span class="class"><span class="keyword">class</span>-<span class="title">dump</span>-<span class="title">z</span> /<span class="title">usr</span>/<span class="title">bin</span>/</span></span><br></pre></td></tr></table></figure></p>
<h4 id="class_dump_分文件">class_dump 分文件</h4><pre><code><span class="keyword">class</span>-dump-z <span class="keyword">App</span> -<span class="keyword">H</span> -o outputdir
</code></pre><h4 id="class_dump支付宝app">class_dump支付宝app</h4><pre><code>$ class-dump-z Portal &gt; Portal-dump.txt  

@protocol XXEncryptedProtocol_10764b0  
-<span class="ruby">(?)<span class="constant">XXEncryptedMethod_d109df</span>;  
</span>-<span class="ruby">(?)<span class="constant">XXEncryptedMethod_d109d3</span>;  
</span>-<span class="ruby">(?)<span class="constant">XXEncryptedMethod_d109c7</span>;  
</span>-<span class="ruby">(?)<span class="constant">XXEncryptedMethod_d109bf</span>;  
</span>@optional  
-<span class="ruby">(?)<span class="constant">XXEncryptedMethod_d109eb</span>;  
</span>@end  
</code></pre><p>查看得到的信息是加过密的，这个加密操作是苹果在部署到app store时做的，所以我们还需要做一步解密操作</p>
<a id="more"></a>
<h3 id="使用Clutch解密支付宝app">使用Clutch解密支付宝app</h3><h4 id="iOS7越狱后的Cydia源里已经下载不到Clutch了，但是我们可以从网上下载好推进iPhone">iOS7越狱后的Cydia源里已经下载不到Clutch了，但是我们可以从网上下载好推进iPhone</h4><p>地址:<a href="https://github.com/KJCracks/Clutch-dl/releases" target="_blank" rel="external">https://github.com/KJCracks/Clutch-dl/releases</a></p>
<h4 id="查看可解密的应用列表">查看可解密的应用列表</h4><pre><code>root<span class="comment"># ./Clutch   </span>

Clutch-<span class="number">1.3</span>.2  
usage: ./Clutch [flags] [<span class="type">application</span> <span class="property">name</span>] [...]  
Applications available: <span class="number">9</span>P_RetinaWallpapers breadtrip Chiizu CodecademyiPhone FisheyeFree food GirlsCamera IMDb InstaDaily InstaTextFree iOne ItsMe3 linecamera Moldiv MPCamera MYXJ NewsBoard Photo Blur Photo Editor PhotoWonder POCO相机 Portal QQPicShow smashbandits Spark tripcamera Tuding_vITC_01 wantu WaterMarkCamera WeiBo Weibo
</code></pre><h4 id="解密支付宝app">解密支付宝app</h4><pre><code><span class="literal">root</span><span class="comment"># ./Clutch Portal</span>
</code></pre><h3 id="导出已解密的支付宝app">导出已解密的支付宝app</h3><p>从上一步骤得知，已解密的ipa位置为：/var/root/Documents/Cracked/支付宝钱包-v8.0.0-(Clutch-1.3.2).ipa<br>将其拷贝到本地去分析</p>
<h3 id="class_dump已解密的支付宝app">class_dump已解密的支付宝app</h3><p>解压.ipa后，到 支付宝钱包-v8.0.0-(Clutch-1.3.2)/Payload/Portal.app 目录下，class_dump已解密的二进制文件</p>
<pre><code><span class="class"><span class="keyword">class</span>-<span class="title">dump</span>-<span class="title">z</span> <span class="title">Portal</span> &gt; ~/<span class="title">Portal</span>-<span class="title">classdump</span>.<span class="title">txt</span></span>
</code></pre><h3 id="iOS运行时工具-cycript">iOS运行时工具-cycript</h3><p>网址：<a href="http://www.cycript.org/" target="_blank" rel="external">http://www.cycript.org/</a></p>
<h3 id="使用introspy追踪分析应用程序">使用introspy追踪分析应用程序</h3><ol>
<li><p>下载 <a href="https://github.com/iSECPartners/Introspy-iOS/releases" target="_blank" rel="external">https://github.com/iSECPartners/Introspy-iOS/releases</a> 将其拷贝到设备中，并执行安装命令<br><code># dpkg -i com.isecpartners.introspy-v0.4-ios_7.deb</code></p>
</li>
<li><p>重启设备：<br><code># killall SpringBoard</code></p>
</li>
<li>到设置中，就可以查看到instrospy的设置选项了</li>
<li>在Introspy-Apps中选择要跟踪的app名称。Instrospy-Settings则提供一些常规跟踪设置选项，默认是全部开启</li>
<li>然后启动想要跟踪的应用程序，就可以直接查看log获取Instrospy为我们跟踪捕获的信息，<br>这里以跟踪支付宝app为例</li>
<li>打开支付宝app，选择添加银行卡，随意添加一个卡号，然后点击下一步</li>
<li>支付宝app反馈添加失败，该卡暂不支持，Instrospy捕获的信息也很清晰：<br><img src="http://img.blog.csdn.net/20140208142548437?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveWl5YWFpeHVleGk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></li>
<li>追踪信息被保存为一个数据库introspy-com.alipay.iphoneclient.db，存放在：<br>./private/var/mobile/Applications/4763A8A5-2E1D-4DC2-8376-6CB7A8B98728/Library/<br>introspy-com.alipay.iphoneclient.db</li>
<li>也可以借助Introspy-Analyzer在本地将该数据库解析成一个直观的report.html查看</li>
<li>将introspy-com.alipay.iphoneclient.db拷贝到本地，执行：<br>python introspy.py -p ios —outdir Portal-introspy-html introspy-com.alipay.iphoneclient.db  </li>
<li>就会生成一个 Portal-introspy-html  文件夹，该目录下有 report.html ，用浏览器打开<br><code>open report.html</code></li>
<li>就可以清晰的查看追踪信息了，主要分为DataStorage、IPC、Misc、Network、Crypto六大类信息<br>举个例子，选择Crypto可以查看支付宝app采取了什么加密措施，如果你看过我之前的文章，<br>一定会一眼就认出来手势密码的：</li>
</ol>
<h3 id="使用Cycript修改支付宝app运行时">使用Cycript修改支付宝app运行时</h3><h4 id="安装Cycript">安装Cycript</h4><p>到<a href="http://www.cycript.org/" target="_blank" rel="external">Cycript</a>官方网站下载资源工具，然后推进已越狱的iPhone中，进行安装：</p>
<pre><code>dpkg -<span class="tag">i</span> cycript_0.<span class="number">9.461</span>_iphoneos-arm<span class="class">.deb</span>  
dpkg -<span class="tag">i</span> libffi_1-<span class="number">3.0</span>.<span class="number">10</span>-<span class="number">5</span>_iphoneos-arm<span class="class">.deb</span>  
</code></pre><h4 id="确定支付宝进程">确定支付宝进程</h4><p>运行支付宝app，然后获取它的进程号：</p>
<pre><code><span class="label">Primer:</span>/ root<span class="preprocessor"># ps aux | grep Portal </span>
</code></pre><h4 id="Cycript钩住支付宝进程">Cycript钩住支付宝进程</h4><pre><code>cycript -<span class="tag">p</span> <span class="number">479</span>  
</code></pre><h4 id="获取当前界面的viewController并修改背景色">获取当前界面的viewController并修改背景色</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">cy<span class="comment"># var app = [UIApplication sharedApplication]  </span></span><br><span class="line">@<span class="string">"&lt;DFApplication: 0x16530660&gt;"</span>  </span><br><span class="line">  </span><br><span class="line">cy<span class="comment"># app.delegate  </span></span><br><span class="line">@<span class="string">"&lt;DFClientDelegate: 0x165384d0&gt;"</span>  </span><br><span class="line">  </span><br><span class="line">cy<span class="comment"># var keyWindow = app.keyWindow  </span></span><br><span class="line">@<span class="string">"&lt;UIWindow: 0x1654abb0; frame = (0 0; 320 568); gestureRecognizers = &lt;NSArray: 0x1654b190&gt;; layer = &lt;UIWindowLayer: 0x1654ace0&gt;&gt;"</span>  </span><br><span class="line">  </span><br><span class="line">cy<span class="comment"># var rootController = keyWindow.rootViewController  </span></span><br><span class="line">@<span class="string">"&lt;DFNavigationController: 0x1654b6c0&gt;"</span>  </span><br><span class="line">  </span><br><span class="line">cy<span class="comment"># var visibleController = rootController.visibleViewController  </span></span><br><span class="line">@<span class="string">"&lt;ALPLauncherController: 0x166acfb0&gt;"</span>  </span><br><span class="line">  </span><br><span class="line">cy<span class="comment"># visibleController.childViewControllers  </span></span><br><span class="line">@[<span class="string">"&lt;HPHomeWidgetGroup: 0x166afbc0&gt;"</span>,<span class="string">"&lt;ADWRootViewController: 0x165745c0&gt;"</span>,<span class="string">"&lt;ALPAssetsRootViewController: 0x16577250&gt;"</span>,<span class="string">"&lt;SWSecurityWidgetGroup: 0x166bd940&gt;"</span>]  </span><br><span class="line">  </span><br><span class="line">cy<span class="comment"># var assetsController = new Instance(0x16577250)  </span></span><br><span class="line">@<span class="string">"&lt;ALPAssetsRootViewController: 0x16577250&gt;"</span>  </span><br><span class="line">  </span><br><span class="line">cy<span class="comment"># assetsController.view.backgroundColor = [UIColor blueColor]  </span></span><br><span class="line">@<span class="string">"UIDeviceRGBColorSpace 0 0 1 1"</span></span><br></pre></td></tr></table></figure>
<h3 id="gbd">gbd</h3><blockquote>
<p>Cycript can not set break point<br>Cycript can not alter value of variable and register</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">//attach GDB-Demo.PID</span><br><span class="line">(gdb) attach GDB-Demo.<span class="number">1438</span></span><br><span class="line"></span><br><span class="line">(gdb)<span class="built_in">break</span> loginButtonTapped:</span><br><span class="line">(gdb)c</span><br><span class="line">(gdb)disas                  //<span class="built_in">print</span> disassemble of the <span class="keyword">function</span></span><br><span class="line">//whenever an external method is called or a property is accessed, the objc_msgSend <span class="keyword">function</span> is called</span><br><span class="line">// blx      ===== objc_msgSend</span><br><span class="line">(gdb)<span class="built_in">break</span> *<span class="number">0</span>x0007e428</span><br><span class="line">(gdb)b *<span class="number">0</span>x0007e45e</span><br><span class="line">(gdb)c</span><br><span class="line">(gdb) x/s <span class="variable">$r1</span></span><br><span class="line">(gdb) po <span class="variable">$r2</span>        //Admin</span><br><span class="line">(gdb)x/a <span class="variable">$2</span>         //<span class="number">0</span>x80910  __CFConstantStringClassReference</span><br><span class="line">(gdb)po    <span class="number">0</span>x80910</span><br><span class="line"></span><br><span class="line">//<span class="built_in">break</span> cmp address</span><br><span class="line">(gdb)b *<span class="number">0</span>x0007e4a8</span><br><span class="line">(gdb)b *<span class="number">0</span>x0007e52c</span><br><span class="line">(gdb)c</span><br><span class="line">(gdb)<span class="built_in">set</span> <span class="variable">$r0</span> = <span class="number">1</span></span><br><span class="line">(gdb)<span class="built_in">set</span> <span class="variable">$r0</span> = <span class="number">1</span></span><br><span class="line">(gdb)c</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">break</span> objc_msgSend</span><br><span class="line">c                    //<span class="built_in">continue</span></span><br><span class="line"><span class="built_in">help</span> x               // 显示命令</span><br><span class="line">x/a <span class="variable">$r0</span>              //object  show  register <span class="number">0</span></span><br><span class="line">x/s <span class="variable">$r1</span>              //string</span><br><span class="line">x/s <span class="variable">$r2</span>              //</span><br></pre></td></tr></table></figure>
<h4 id="批处理命令">批处理命令</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(gdb)commands</span><br><span class="line">&gt;x/a  <span class="variable">$r0</span></span><br><span class="line">&gt;x/s  <span class="variable">$r1</span></span><br><span class="line">&gt;c</span><br><span class="line">&gt;end</span><br><span class="line">c</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(gdb)commands</span><br><span class="line">&gt;<span class="built_in">printf</span> <span class="string">"[%s, %s]\n"</span>,(char *)class_getName(**<span class="variable">$r0</span>),<span class="variable">$1</span></span><br><span class="line">&gt;c</span><br><span class="line">&gt;end</span><br></pre></td></tr></table></figure>
<h3 id="JailBroken_bypass">JailBroken bypass</h3><ol>
<li>class-dump-z find isJailBroken;</li>
<li>Cycript -p 2166</li>
<li>JailbreakDetector-&gt;isa.messages</li>
<li>JailbreakDetector-&gt;isa.messages[‘isJailbroken’] = function(){return false;}</li>
</ol>
<h3 id="Ida_patch">Ida patch</h3><p>~/Library/Application\ Support/iPhone\ Simulator/<br>~/Library/Developer/CoreSimulator/Devices/<device-specific-hash>/data/Container‌​s/Bundle/Application/<app-specific-hash></app-specific-hash></device-specific-hash></p>
<h4 id="IDA">IDA</h4><ol>
<li><p>show graphical format, double click on the function name in the functions window<br>and press Space</p>
</li>
<li><p>If you want to switch to the previous view, you can press Space again</p>
</li>
<li>As we can clearly see, the address of this instruction is 00002CB1. However, we cannot just go ahead and change the address at this instruction, This is because this address is the absolute address of this instruction and it will be different every time the application is launched. What we need to find out is the offset of this instruction relative to the Mach-O binary. This instruction has to be modified in the code section of the assembly. Hence the offset of this instruction relative to the binary can be calculated as<figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">//(Offset <span class="keyword">of</span> code section relative to binary) +  (Absolute address <span class="keyword">of</span> the instruction to be changed -  Starting address <span class="keyword">of</span> the code section)</span><br><span class="line">Absolute address : 00002A62</span><br><span class="line"></span><br><span class="line">otool -l GDB-Demo</span><br><span class="line">//Look for the text section</span><br><span class="line"><span class="title">Section</span></span><br><span class="line">  sectname __text</span><br><span class="line">   segname __TEXT</span><br><span class="line">      addr 0x00000001000016c9</span><br><span class="line">      size 0x0000000000000329</span><br><span class="line">    offset 5833</span><br><span class="line">     align 2^0 (1)</span><br><span class="line">    reloff 0</span><br><span class="line">    nreloc 0</span><br><span class="line">     flags 0x80000400</span><br><span class="line"> reserved1 0</span><br><span class="line"> reserved2 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> start address: 0x00000001000016c9</span><br><span class="line"> offset: 5833</span><br><span class="line"></span><br><span class="line"> 5833(Decimal) + (0x00002A62(Hex)- 0x00000001000016c9(Hex)) = 0x1cb1</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="URL_Schemes">URL Schemes</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="xml">document.location=‘tel://1123456789’<span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="xml"></span><br><span class="line"><span class="tag">&lt;<span class="title">iframe</span> <span class="attribute">src</span>=<span class="value">“tel:</span>//<span class="attribute">1123456789</span>”&gt;</span><span class="tag">&lt;/<span class="title">iframe</span>&gt;</span></span></span></span><br></pre></td></tr></table></figure>
<h3 id="IRET">IRET</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget --no-check-certificate https://www.veracode.com/sites/default/files/Resources/Tools/iRETTool.zip</span><br><span class="line"></span><br><span class="line">unzip iRETTool.zip</span><br><span class="line">dpkg -i iRET.deb  //reboot your device <span class="keyword">then</span> launch the app</span><br><span class="line"></span><br><span class="line">//install dumpdecrypted</span><br></pre></td></tr></table></figure>
<h3 id="dumpdecrypted">dumpdecrypted</h3><ol>
<li>download file</li>
<li>make</li>
<li>copy .dylib to your device//drag and drop inside the folder /Library using iExplorer</li>
</ol>
<h3 id="Theos">Theos</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> THEOS=/opt/theos</span><br><span class="line">svn co http://svn.howett.net/svn/theos/trunk <span class="variable">$THEOS</span></span><br></pre></td></tr></table></figure>
<h4 id="ldid">ldid</h4><p>ldid的作用是模拟给iPhone签名的流程，使得你能够在真实的设备上安装越狱的apps/hacks</p>
<pre><code>cp ~<span class="regexp">/Copy/ios</span><span class="regexp">/ldid /opt</span><span class="regexp">/theos/bin</span><span class="regexp">/ldid</span>
</code></pre><h4 id="dkpg">dkpg</h4><pre><code><span class="keyword">brew </span>install dkpg
</code></pre><h4 id="theos_使用">theos 使用</h4><ol>
<li>下载libsubstrate.dylib，然后copy到/opt/theos/lib <a href="http://www.mediafire.com/download/2upm53uzzj0488u/libsubstrate.dylib" target="_blank" rel="external">http://www.mediafire.com/download/2upm53uzzj0488u/libsubstrate.dylib</a><br>2．iOS 头文件<br>很可能theos本身就自带了你所需要的头文件，但是，如果你编译程序的时候提示你头文件相关的问题，那你就需要准备相关的头文件了。要么从设备上dump头文件，要么google，建议你先google一下，看其他人有没已经提供了这些头文件。<br>一旦你有这些头文件，记得把它们放在/opt/theos/include</li>
<li>创建项目<br><code>$THEOS/bin/nic.pl</code></li>
<li><p>The Tweak File</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">vim Tweak.xm</span><br><span class="line">%hook Springboard <span class="comment">// overwrite methods here %end </span></span><br><span class="line"></span><br><span class="line">#<span class="keyword">import</span>&lt;SpringBoard/SpringBoard.h&gt;  </span><br><span class="line">%hook SpringBoard </span><br><span class="line"> -(<span class="typename">void</span>)<span class="string">applicationDidFinishLaunching:</span>(id)application &#123; </span><br><span class="line">%orig; </span><br><span class="line"> UIAlertView *alert = [[UIAlertViewalloc] </span><br><span class="line"><span class="string">initWithTitle:</span>@<span class="string">"Welcome"</span>  <span class="string">message:</span>@<span class="string">"Welcome to your iPhone Brandon!"</span>  </span><br><span class="line"><span class="string">delegate:</span><span class="string">nilcancelButtonTitle:</span>@<span class="string">"Thanks"</span>  </span><br><span class="line"><span class="string">otherButtonTitles:</span>nil] </span><br><span class="line">[alert show]; </span><br><span class="line">[alert release];</span><br><span class="line"> &#125; </span><br><span class="line"> %end</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加Framework</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim Makefile</span><br><span class="line"></span><br><span class="line">WelcomeWagon_FRAMEWORKS = <span class="built_in">UIKit</span><span class="comment">//add</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Building, Packaging, Installing</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">make</span></span><br><span class="line"><span class="built_in">make</span> <span class="keyword">package</span></span><br><span class="line">Dpkg –i     <span class="comment">//install</span></span><br><span class="line">dpkg -r     <span class="comment">//remove</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="logify">logify</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mkdir Headers</span><br><span class="line">class-dump-z App -H -o Headers</span><br><span class="line"><span class="built_in">cd</span> Headers//check header files</span><br><span class="line"></span><br><span class="line">//add trace the method </span><br><span class="line">/opt/theos/bin/logify.pl ClientSideInjectionVC.h &gt; Tweak.xm</span><br><span class="line">/opt/theos/bin/logify.pl JailbreakDetectionVC.h &gt; Tweak.xm</span><br><span class="line">/opt/theos/bin/logify.pl DamnVulnerableAppUtilities.h &gt; Tweak.xm</span><br></pre></td></tr></table></figure>

      
    </div>

    <div class="post-footer">
      

      
        <div class="post-nav">
          <div class="post-nav-prev post-nav-item">
            
              <a href="/2015/05/30/ios-reverse-tutorial/">ios reverse tutorial</a>
            
          </div>

          <div class="post-nav-next post-nav-item">
            
              <a href="/2015/05/29/git-tutorials-workflows/">git tutorials -- workflows</a>
            
          </div>
        </div>
      

      
      
    </div>
  </div>



    
      <div class="comments" id="comments">
        
          <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          </div>
        
      </div>
    
  </div>


        </div>

        
      </div>


      
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <div id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目錄
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            本站概覽
          </li>
        </ul>
      

      <div class="site-overview">
        <div class="site-author motion-element">
          <img class="site-author-image" src="/avatar.png" alt="Yt" />
          <p class="site-author-name">Yt</p>
        </div>
        <p class="site-description motion-element">notes for study</p>
        <div class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">187</span>
              <span class="site-state-item-name">文章</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            <a href="/categories">
              <span class="site-state-item-count">27</span>
              <span class="site-state-item-name">分類</span>
              </a>
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">92</span>
              <span class="site-state-item-name">標籤</span>
              </a>
          </div>

        </div>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml">
              <i class="menu-item-icon icon-feed"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
              <a href="https://github.com/ytlvy" target="_blank">GitHub</a>
            </span>
            
              <span class="links-of-author-item">
              <a href="https://twitter.com/ytlvy" target="_blank">Twitter</a>
            </span>
            
              <span class="links-of-author-item">
              <a href="http://nshipster.com" target="_blank">NSHipster</a>
            </span>
            
              <span class="links-of-author-item">
              <a href="http://www.mikeash.com/pyblog" target="_blank">NSBlog</a>
            </span>
            
              <span class="links-of-author-item">
              <a href="http://www.objc.io" target="_blank">objcio</a>
            </span>
            
              <span class="links-of-author-item">
              <a href="http://www.raywenderlich.com" target="_blank">raywenderlich</a>
            </span>
            
          
        </div>

        
        
          <div class="cc-license motion-element">
            <a href="http://creativecommons.org/licenses/by-nc-sa/4.0" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons" />
            </a>
          </div>
        

      </div>

      
        <div class="post-toc-wrap sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator"></div>
          <div class="post-toc">
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#class-dump-z"><span class="nav-number">1.</span> <span class="nav-text">class-dump-z</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#下载配置class_dump_z"><span class="nav-number">1.1.</span> <span class="nav-text">下载配置class_dump_z</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#class_dump_分文件"><span class="nav-number">1.2.</span> <span class="nav-text">class_dump 分文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#class_dump支付宝app"><span class="nav-number">1.3.</span> <span class="nav-text">class_dump支付宝app</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用Clutch解密支付宝app"><span class="nav-number">2.</span> <span class="nav-text">使用Clutch解密支付宝app</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#iOS7越狱后的Cydia源里已经下载不到Clutch了，但是我们可以从网上下载好推进iPhone"><span class="nav-number">2.1.</span> <span class="nav-text">iOS7越狱后的Cydia源里已经下载不到Clutch了，但是我们可以从网上下载好推进iPhone</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#查看可解密的应用列表"><span class="nav-number">2.2.</span> <span class="nav-text">查看可解密的应用列表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#解密支付宝app"><span class="nav-number">2.3.</span> <span class="nav-text">解密支付宝app</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#导出已解密的支付宝app"><span class="nav-number">3.</span> <span class="nav-text">导出已解密的支付宝app</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#class_dump已解密的支付宝app"><span class="nav-number">4.</span> <span class="nav-text">class_dump已解密的支付宝app</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#iOS运行时工具-cycript"><span class="nav-number">5.</span> <span class="nav-text">iOS运行时工具-cycript</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用introspy追踪分析应用程序"><span class="nav-number">6.</span> <span class="nav-text">使用introspy追踪分析应用程序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用Cycript修改支付宝app运行时"><span class="nav-number">7.</span> <span class="nav-text">使用Cycript修改支付宝app运行时</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#安装Cycript"><span class="nav-number">7.1.</span> <span class="nav-text">安装Cycript</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#确定支付宝进程"><span class="nav-number">7.2.</span> <span class="nav-text">确定支付宝进程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Cycript钩住支付宝进程"><span class="nav-number">7.3.</span> <span class="nav-text">Cycript钩住支付宝进程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#获取当前界面的viewController并修改背景色"><span class="nav-number">7.4.</span> <span class="nav-text">获取当前界面的viewController并修改背景色</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#gbd"><span class="nav-number">8.</span> <span class="nav-text">gbd</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#批处理命令"><span class="nav-number">8.1.</span> <span class="nav-text">批处理命令</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JailBroken_bypass"><span class="nav-number">9.</span> <span class="nav-text">JailBroken bypass</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Ida_patch"><span class="nav-number">10.</span> <span class="nav-text">Ida patch</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#IDA"><span class="nav-number">10.1.</span> <span class="nav-text">IDA</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#URL_Schemes"><span class="nav-number">11.</span> <span class="nav-text">URL Schemes</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#IRET"><span class="nav-number">12.</span> <span class="nav-text">IRET</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#dumpdecrypted"><span class="nav-number">13.</span> <span class="nav-text">dumpdecrypted</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Theos"><span class="nav-number">14.</span> <span class="nav-text">Theos</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ldid"><span class="nav-number">14.1.</span> <span class="nav-text">ldid</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#dkpg"><span class="nav-number">14.2.</span> <span class="nav-text">dkpg</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#theos_使用"><span class="nav-number">14.3.</span> <span class="nav-text">theos 使用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#logify"><span class="nav-number">15.</span> <span class="nav-text">logify</span></a></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator"></div>
        </div>
      

    </div>
  </div>


    </div>

    <div id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; &nbsp; 
  2015
  <span class="with-love">
    <i class="icon-heart"></i>
  </span>
  <span class="author">Yt</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 強力驅動
</div>

<div class="theme-info">
  主題 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>
</div>



<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
<div class="theme-info">
  <span id="busuanzi_container_site_uv">
    &nbsp&nbsp&nbsp&nbsp|&nbsp&nbsp Total <span id="busuanzi_value_site_pv"><i class="fa fa-spinner fa-spin"></i></span> views.
您是本站的第<span id="busuanzi_value_site_uv"><i class="fa fa-spinner fa-spin"></i></span>个小伙伴
<span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span> Hits
  </span>
<div>
      </div>
    </div>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js"></script>


  <script type="text/javascript" src="/js/helpers.js"></script>
  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/js/motion_global.js" id="motion.global"></script>




  
  
<script type="text/javascript" src="/js/bootstrap.scrollspy.js" id="bootstrap.scrollspy.custom"></script>


<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var $sidebarInner = $('.sidebar-inner');
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.didShow', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;
          var self = this;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      $(indicator).velocity('stop').velocity({
        opacity: action === 'show' ? 0.4 : 0
      }, { duration: 100 });
    }

  });
</script>


  <script type="text/javascript" id="sidebar.nav">
    $(document).ready(function () {
      var html = $('html');

      $('.sidebar-nav li').on('click', function () {
        var item = $(this);
        var activeTabClassName = 'sidebar-nav-active';
        var activePanelClassName = 'sidebar-panel-active';
        if (item.hasClass(activeTabClassName)) {
          return;
        }

        var currentTarget = $('.' + activePanelClassName);
        var target = $('.' + item.data('target'));

        currentTarget.velocity('transition.slideUpOut', 200, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', 200)
            .addClass(activePanelClassName);
        });

        item.siblings().removeClass(activeTabClassName);
        item.addClass(activeTabClassName);
      });

      $('.post-toc a').on('click', function (e) {
        e.preventDefault();
        var offset = $(escapeSelector(this.getAttribute('href'))).offset().top;
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        });
      });

      // Expand sidebar on post detail page by default, when post has a toc.
      var $tocContent = $('.post-toc-content');
      if (isDesktop() && CONFIG.sidebar === 'post') {
        if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
          displaySidebar();
        }
      }
    });
  </script>




  <script type="text/javascript">
    $(document).ready(function () {
      if (CONFIG.sidebar === 'always') {
        displaySidebar();
      }
    });
  </script>

  

  
  
  

  

    
      
    

    <script type="text/javascript">
      var disqus_shortname = 'ytlvy';
      var disqus_identifier = '2015/05/30/ios-reverse/';
      var disqus_title = 'ios reverse';
      var disqus_url = 'http://ytlvy.com/2015/05/30/ios-reverse/';

      (function(){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }());
    </script>
  




  
  

</body>
</html>
